<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.transfer.room.transferboard.mapper.TransferBoardMapper">

    <resultMap id="TransferBoardDtoMap" type="com.transfer.room.transferboard.dto.TransferBoardDto">
        <id property="transferBoardId" column="tb_id"/>
        <result property="transfererId" column="transferer_id"/>
        <result property="transfereeId" column="transferee_id"/>
        <result property="transferStatus" column="transfer_status"/>
        <result property="transferTitle" column="tb_title"/>
        <result property="transferContent" column="tb_content"/>
        <result property="transferCreateTime" column="tb_create_time"/>
        <result property="transferUpdateTime" column="tb_update_time"/>
        <result property="roomLatitude" column="room_latitude"/>
        <result property="roomLongitude" column="room_longitude"/>
        <result property="roomAddress" column="room_address"/>
        <result property="roomFloor" column="room_floor"/>
        <result property="roomType" column="room_type"/>
        <result property="contractType" column="contract_type"/>
        <result property="contractEndTime" column="contract_end_time"/>
        <result property="sidoName" column="sidoName"/>
        <result property="gugunName" column="gugunName"/>
        <result property="dongName" column="dongName"/>
        <result property="likeCount" column="like_count"/>
    </resultMap>

    <resultMap id="TransferBoardListDtoMap" type="com.transfer.room.transferboard.dto.TransferBoardListDto">
        <id property="transferBoardId" column="tb_id"/>
        <result property="transferTitle" column="tb_title"/>
        <result property="roomLatitude" column="room_latitude"/>
        <result property="roomLongitude" column="room_longitude"/>
        <result property="roomFloor" column="room_floor"/>
        <result property="contractType" column="contract_type"/>
        <result property="roomType" column="room_type"/>
        <result property="contractEndTime" column="contract_end_time"/>
        <result property="likeCount" column="like_count"/>
    </resultMap>

    <select id="selectTransferBoardByArticleId"
            parameterType="int"
            resultMap="TransferBoardDtoMap">
        SELECT tb_id, transferer_id,transferee_id,transfer_status,tb_title,tb_content,
        tb_create_time,tb_update_time, room_latitude, room_longitude, room_address
        , room_floor, room_type, contract_type, contract_end_time
        , dc.sidoName,dc.gugunName,dc.dongName
        FROM transfer_boards as tb
        JOIN regions as dc
        ON tb.dongCode = dc.dongCode
        WHERE tb.tb_id = #{transferBoardId}
        ORDER BY tb.like_count DESC;
    </select>

    <select id="selectTransferBoardByDongCode"
            parameterType="string"
            resultMap="TransferBoardListDtoMap">
        SELECT tb_id, tb_title, room_latitude
        , room_longitude, room_floor, room_type
        , contract_type, contract_end_time, like_count
        FROM transfer_boards as tb
        JOIN regions as dc
        ON tb.dongCode = dc.dongCode
        WHERE tb.dongCode=#{dongCode}
        ORDER BY tb.like_count DESC;
    </select>

    <insert id="insertTransferBoard"
            parameterType="com.transfer.room.transferboard.entity.TransferBoardsEntity"
            useGeneratedKeys="true" keyProperty="tbId">
        INSERT INTO transfer_boards(transferer_id,transferee_id,transfer_status
        ,tb_title,tb_content,tb_create_time,tb_update_time
        ,room_latitude,room_longitude, room_address, room_floor, room_type
        , contract_type,contract_end_time,dongCode, like_count)
        VALUE (#{transfererId},#{transfereeId},#{transferStatus}
        ,#{tbTitle},#{tbContent},now(),now()
        ,#{roomLatitude},#{roomLongitude},#{roomAddress}
        ,#{roomFloor},#{roomType},#{contractType},#{contractEndTime}
        ,#{dongCode}, #{likeCount})
    </insert>

</mapper>

